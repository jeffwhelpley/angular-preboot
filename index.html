<html>
<body>
    <form>
        <input type="text" name="one" (keyup)="blah()"><br/>
        <input type="text" name="two" on-keyup="blah()"><br/>
        <input type="text" name="three"><br/>
        <button (click)="doit()">Click here</button>
        <br/><br/>
        <a href="" onclick="return log()">Log events to console</a>
        <br/><br/>
        <a href="" onclick="angularPreBoot.cleanup(); return false;">Do cleanup</a>
    </form>
    <script>
        (function () {

            // this is where we will store all the preboot events
            var preboot = window.angularPreBoot = { events: [] };

            // maintain the list of event listeners so we can remove them later
            var eventListeners = [];

            // regular expression for finding event
            var eventPattern = /^(on\-.*)|(\(.*\))$/;

            /**
             * Attach function to preboot that can be used to cleanup all resources.
             * This includes event handlers and the events themselves.
             */
            preboot.cleanup = function () {
                var listener, node;

                // first cleanup the event listeners
                for (var i = 0; i < eventListeners.length; i++) {
                    listener = eventListeners[i];
                    node = listener.node;
                    node.removeEventListener(listener.name, listener.handler);
                }

                // now remove the events
                preboot.events = [];
            };

            /**
             * This is from Crockford to walk the DOM:
             *  http://www.javascriptcookbook.com/article/Traversing-DOM-subtrees-with-a-recursive-walk-the-DOM-function/
             *
             * @param node The current node (to do entire document, pass in document.body)
             * @param func Function called for each node in the tree
             */
            function walkDOM(node, func) {
                func(node);
                node = node.firstChild;
                while (node) {
                    walkDOM(node,func);
                    node = node.nextSibling;
                }
            }

            /**
             * For a given node, add an event listener based on the given attribute. The attribute
             * must match the Angular pattern for event handlers (i.e. either (event)='blah()' or
             * on-event='blah'
             *
             * @param node An element in the DOM
             * @param attr An attribute in the element
             */
            function addListener(node, attr) {
                var name = attr.name;

                // if attribute name doesn't match Angular event handlers, don't do anything
                if (!eventPattern.test(name)) {
                    return;
                }

                // extract event name from the () or on- (TODO: replace this w regex)
                name = name.charAt(0) === '(' ?
                        name.substring(1, name.length - 1) :    // remove parenthesis
                        name.substring(3);                      // remove on-

                function handler(event) {

                    // if we are having angular handle events, we don't want to do the default
                    event.preventDefault();

                    // push event and other relevant info onto the preboot events
                    preboot.events.push({
                        node:       node,
                        event:      event,
                        name:       name,
                        handler:    attr.value,
                        time:       (new Date()).getTime()
                    })
                }

                // add listener which will record all events in global preboot object
                node.addEventListener(name, handler);

                // add handler to list so it can be removed later
                eventListeners.push({ node: node, name: name, handler: handler });
            }

            // with each DOM node, we check the attributes for event listeners
            walkDOM(document.body, function (node) {
                var attrs = node.attributes;
                if (attrs) {
                    for (var i = 0; i < attrs.length; i++) {
                        addListener(node, attrs[i]);
                    }
                }
            });
        })();

        // function to test that we recorded all events
        function log() {
            console.log(angularPreBoot.events);
            return false;
        }

    </script>
</body>
</html>